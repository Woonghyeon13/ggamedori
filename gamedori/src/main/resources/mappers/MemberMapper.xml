<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="game.dori.mapper.MemberMapper">

	<!--  회원가입 아이디 중복체크 용 sql문 -->
	<select id="selectByEmail" resultType="memberVO">
    SELECT * FROM member_tb WHERE member_email = #{email}
	</select>
	 
	 
	 <!--  login sql 구문 -->
	 <select id ="Login" resultType="memberVO">
	 	
	 	select * from member_tb where member_email = #{member_email} and member_pw = #{member_pw}

	 </select>
	 
	<!--  회원가입 정보 멤버 sql 구문 -->
	<insert id="insertMember" parameterType="memberVO" useGeneratedKeys="true" keyProperty="member_idx">
	    INSERT INTO member_tb(MEMBER_EMAIL, MEMBER_EMAIL_KEY, MEMBER_PW, MEMBER_NAME, MEMBER_PHONE)
	    VALUES (#{member_email}, #{member_email_key}, #{member_pw}, #{member_name}, #{member_phone})
	</insert>
	
	<!--  이메일 인증시 yn 업그레이드 sql 구문 -->
	<update id="updateMemberyn" parameterType="memberVO">
	    UPDATE member_tb
	    SET
	        member_email_yn = #{member_email_yn}
	    WHERE
	        member_email = #{member_email}
	</update>
	

	<select id="memberlist" resultType="memberVO">
		select * 
			from member_tb where member_role = "1"
	</select>
	
	<update id="updateMemberState" parameterType="memberVO">
	    UPDATE member_tb
	    SET
	        member_state = #{member_state}
	    WHERE
	        member_idx = #{member_idx}
	</update>
	

	
	<delete id="delete_member" parameterType="MemberVO">
	  DELETE FROM member_tb
	  WHERE member_email = #{member_email} AND member_pw = #{member_pw}
	</delete>
	
	<update id="updateMember" parameterType="MemberVO">
	    UPDATE member_tb
	    SET
	        member_pw = #{member_pw},
	        member_phone = #{member_phone}
	    WHERE
	        member_idx = #{member_idx}
	</update>
	
	<!-- 마이페이지 등급  -->
	<select id="selectMemberLevelMapper" parameterType="int" resultType="int">
		SELECT member_level
		FROM member_tb
		WHERE member_idx = #{member_idx}
	</select>
	
	<!-- 누적적립금에 따른 등급업 -->
	<update id="MemberLevelUP">
		UPDATE member_tb
		SET member.level =
			CASE
				WHEN savept_amount >= 3000 THEN 2 	<!-- 누적적립금 30만원(삼천점) 이상 실버 -->
				WHEN savept_amount >= 10000 THEN 3 	<!-- 누적적립금 100만원(만점) 이상 골드 -->
				ELSE 1
			END
		FROM savepoint_tb
		WHERE savepoint_tb.member_tb_idx = member_tb.idx
		AND savepoint_tb.member_tb_idx = #{member_idx}
	</update>
	

</mapper>

